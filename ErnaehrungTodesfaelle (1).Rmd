---
title: "Ernährungsbedingte Todesfälle weltweit: Eine Analyse"
output: ioslides_presentation
date: "2023-12-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


## Todesfälle durch Ernährung 1990
```{r echo=FALSE, message=FALSE, warning=FALSE}

library(dplyr)
library(rnaturalearth)
library(rnaturalearthdata)
library(scales)
library(leaflet)
library(RColorBrewer)

world_map <- ne_countries(scale = "medium", returnclass = "sf")
medicalData <- read.csv("C:/Users/Aldo/Documents/Number-of-Deaths-by-Risk-Factor.csv")

# Selecting columns related to diet features
diet_columns <- c(
  "Excess.Sodium",
  "Diet.Low.in.Fruits",
  "Diet.Low.in.Nuts.and.Seeds",
  "High.Fasting.Plasma.Glucose",
  "High.Body.Mass.Index.Obesity.",
  "Vitamin..Deficiency",
  "Iron.Deficiency",
  "High.LDL.Cholesterol"
)

# Filter data for the specified year
medical_data_1990 <- subset(medicalData, Year == '1990')

# Create a dataframe for diet-related columns
diet_data <- data.frame(
  Country = medical_data_1990$Country,
  `Excess.Sodium` = medical_data_1990$"Excess.Sodium",
  `Diet.Low.in.Fruits` = medical_data_1990$"Diet.Low.in.Fruits",
  `Diet.Low.in.Nuts.and.Seeds` = medical_data_1990$"Diet.Low.in.Nuts.and.Seeds",
  `High.Fasting.Plasma.Glucose` = medical_data_1990$"High.Fasting.Plasma.Glucose",
  `High.Body.Mass.Index.Obesity.` = medical_data_1990$"High.Body.Mass.Index.Obesity.",
  `Vitamin..Deficiency` = medical_data_1990$"Vitamin..Deficiency",
  `Iron.Deficiency` = medical_data_1990$"Iron.Deficiency",
  `High.LDL.Cholesterol` = medical_data_1990$"High.LDL.Cholesterol"
)

# Aggregate the diet-related data by summing for each country
diet_data_aggregated <- diet_data %>%
  group_by(Country) %>%
  summarize(across(all_of(diet_columns), ~ sum(.x, na.rm = TRUE))) %>%
  mutate(Total_Diet_Deaths = rowSums(across(all_of(diet_columns))))

# Merge aggregated diet data with world map data
merged_data <- merge(world_map, diet_data_aggregated, by.x = "name", by.y = "Country", all.x = TRUE)

# Transform the spatial data to the correct datum
merged_data <- sf::st_transform(merged_data, "+proj=longlat +datum=WGS84")

# Create a custom color palette with 18 colors
my_palette <- colorRampPalette(brewer.pal(9, "Reds"))

# Create a continuous color palette function
color_pal <- colorNumeric(my_palette(100), merged_data$Total_Diet_Deaths)

leaflet(merged_data) %>%
  addProviderTiles("CartoDB.Positron") %>%
  addPolygons(
    fillColor = ~color_pal(Total_Diet_Deaths),
    weight = 1,
    opacity = 1,
    color = "white",
    fillOpacity = 0.8,
    highlight = highlightOptions(
      weight = 2,
      color = "white",
      fillOpacity = 1,
      bringToFront = TRUE
    ),
    label = ~paste(name, ":", format(round(Total_Diet_Deaths, digits = 2), big.mark = ".",decimal.mark = ",", nsmall = 2), sep = ""),
    options = pathOptions(keepInView = TRUE)  # Add the keepInView option
  ) %>%
  addLegend(
    position = "bottomright",
    pal = color_pal,
    values = ~Total_Diet_Deaths,
    title = "Todesfälle durch <br> Fehlernährung - 1990",
    opacity = 1
  ) %>%
  setView(lng = 0, lat = 30, zoom = 2)


